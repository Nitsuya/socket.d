/*!
 * Socket.D v2.3.0
 * (c) 2023-2024 noear.org and other contributors
 * Released under the Apache-2.0 License.
 */
var e={704:(e,t,s)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SocketD=void 0;const r=s(911),i=s(545),a=s(243),o=s(481),l=s(165),h=s(852),u=s(797);class c{static version(){return"2.3.0"}static protocolVersion(){return"1.0"}static createClient(e){const t=this.createClientOrNull(e);if(null==t)throw new Error("No socketd client providers were found.");return t}static createClientOrNull(e){r.Asserts.assertNull("serverUrl",e);const t=e.indexOf("://");if(t<2)throw new Error("The serverUrl invalid: "+e);const s=e.substring(0,t),n=this.clientProviderMap.get(s);if(null==n)return null;{const t=new i.ClientConfig(e);return n.createClient(t)}}static createClusterClient(e){return new a.ClusterClient(e)}static newEntity(e){return e?e instanceof File?new l.FileEntity(e):e instanceof ArrayBuffer||e instanceof Blob?(new l.EntityDefault).dataSet(e):new l.StringEntity(e.toString()):new l.EntityDefault}static newSimpleListener(){return new h.SimpleListener}static newEventListener(e){return new h.EventListener(e)}static newPathListener(e){return new h.PathListener(e)}static newPipelineListener(){return new h.PipelineListener}}t.SocketD=c,n=c,c.Metas=u.EntityMetas,c.clientProviderMap=new Map,(()=>{const e=new o.WsClientProvider;for(const t of e.schemas())n.clientProviderMap.set(t,e)})()},243:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClusterClient=void 0;const n=s(270),r=s(704);t.ClusterClient=class{constructor(e){this._serverUrls=e instanceof Array?e:[e]}heartbeatHandler(e){return this._heartbeatHandler=e,this}config(e){return this._configHandler=e,this}listen(e){return this._listener=e,this}async open(){const e=new Array;for(const t of this._serverUrls)for(let s of t.split(",")){if(s=s.trim(),!s)continue;const t=r.SocketD.createClient(s);null!=this._listener&&t.listen(this._listener),null!=this._configHandler&&t.config(this._configHandler),null!=this._heartbeatHandler&&t.heartbeatHandler(this._heartbeatHandler);const n=await t.open();e.push(n)}return new n.ClusterClientSession(e)}}},270:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClusterClientSession=void 0;const n=s(404),r=s(921),i=s(422);t.ClusterClientSession=class{constructor(e){this._sessionSet=e,this._sessionId=n.StrUtils.guid(),this._sessionRoundCounter=0}getSessionAll(){return this._sessionSet}getSessionOne(){if(0==this._sessionSet.length)throw new r.SocketdException("No session!");if(1==this._sessionSet.length)return this._sessionSet[0];{const e=new Array;for(const t of this._sessionSet)t.isValid()&&e.push(t);if(0==e.length)throw new r.SocketdException("No session is available!");if(1==e.length)return e[0];const t=this._sessionRoundCounter++,s=t%e.length;return t>999999999&&(this._sessionRoundCounter=0),e[s]}}isValid(){for(const e of this._sessionSet)if(e.isValid())return!0;return!1}sessionId(){return this._sessionId}reconnect(){for(const e of this._sessionSet)0==e.isValid()&&e.reconnect()}send(e,t,s){return this.getSessionOne().send(e,t,s)}sendAndRequest(e,t,s,n){return this.getSessionOne().sendAndRequest(e,t,s,n)}sendAndSubscribe(e,t,s,n){return this.getSessionOne().sendAndSubscribe(e,t,s,n)}close(){for(const e of this._sessionSet)i.RunUtils.runAndTry(e.close)}}},921:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SocketdTimeoutException=t.SocketdSizeLimitException=t.SocketdConnectionException=t.SocketdCodecException=t.SocketdChannelException=t.SocketdAlarmException=t.SocketdException=void 0;class s extends Error{constructor(e){super(e)}}t.SocketdException=s,t.SocketdAlarmException=class extends s{constructor(e){super(e.entity().dataAsString()),this._from=e}getFrom(){return this._from}},t.SocketdChannelException=class extends s{constructor(e){super(e)}},t.SocketdCodecException=class extends s{constructor(e){super(e)}},t.SocketdConnectionException=class extends s{constructor(e){super(e)}},t.SocketdSizeLimitException=class extends s{constructor(e){super(e)}},t.SocketdTimeoutException=class extends s{constructor(e){super(e)}}},421:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClientBase=void 0;const n=s(405),r=s(213),i=s(39);t.ClientBase=class{constructor(e,t){this._config=e,this._assistant=t,this._processor=new n.ProcessorDefault}getAssistant(){return this._assistant}getHeartbeatHandler(){return this._heartbeatHandler}getHeartbeatInterval(){return this.getConfig().getHeartbeatInterval()}getConfig(){return this._config}getProcessor(){return this._processor}heartbeatHandler(e){return null!=e&&(this._heartbeatHandler=e),this}config(e){return null!=e&&e(this._config),this}listen(e){return null!=e&&this._processor.setListener(e),this}async open(){const e=this.createConnector(),t=await e.connect(),s=new r.ClientChannel(t,e);s.setHandshake(t.getHandshake());const n=new i.SessionDefault(s);return t.setSession(n),console.info("Socket.D client successfully connected!"),n}}},213:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClientChannel=void 0;const n=s(998),r=s(569),i=s(797),a=s(911),o=s(921),l=s(422);class h extends n.ChannelBase{constructor(e,t){super(e.getConfig()),this._connector=t,this._real=e,null==t.heartbeatHandler()?this._heartbeatHandler=new r.HeartbeatHandlerDefault(null):this._heartbeatHandler=new r.HeartbeatHandlerDefault(t.heartbeatHandler()),this.initHeartbeat()}initHeartbeat(){this._heartbeatScheduledFuture&&clearInterval(this._heartbeatScheduledFuture),this._connector.autoReconnect()&&(this._heartbeatScheduledFuture=setInterval((()=>{try{this.heartbeatHandle()}catch(e){console.warn("Client channel heartbeat error",e)}}),this._connector.heartbeatInterval()))}async heartbeatHandle(){if(null!=this._real){if(null==this._real.getHandshake())return;if(this._real.isClosed()==i.Constants.CLOSE4_USER)return void console.debug(`Client channel is closed (pause heartbeat), sessionId=${this.getSession().sessionId()}`)}try{await this.prepareCheck(),this._heartbeatHandler.heartbeat(this.getSession())}catch(e){if(e instanceof o.SocketdException)throw e;throw this._connector.autoReconnect()&&(this._real.close(i.Constants.CLOSE3_ERROR),this._real=null),new o.SocketdChannelException(e)}}async prepareCheck(){return(null==this._real||0==this._real.isValid())&&(this._real=await this._connector.connect(),!0)}isValid(){return null!=this._real&&this._real.isValid()}isClosed(){return null==this._real?0:this._real.isClosed()}async send(e,t){a.Asserts.assertClosedByUser(this._real);try{await this.prepareCheck(),this._real.send(e,t)}catch(e){throw this._connector.autoReconnect()&&(this._real.close(i.Constants.CLOSE3_ERROR),this._real=null),e}}retrieve(e,t){this._real.retrieve(e,t)}reconnect(){this.initHeartbeat(),this.prepareCheck()}onError(e){this._real.onError(e)}close(e){l.RunUtils.runAndTry((()=>clearInterval(this._heartbeatScheduledFuture))),l.RunUtils.runAndTry((()=>this._connector.close())),this._real&&l.RunUtils.runAndTry((()=>this._real.close(e))),super.close(e)}getSession(){return this._real.getSession()}}t.ClientChannel=h},545:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClientConfig=void 0;const n=s(628);class r extends n.ConfigBase{constructor(e){super(!0),e.startsWith("sd:")&&(e=e.substring(3)),this._url=e,this._uri=new URL(e),this._port=parseInt(this._uri.port),this._schema=this._uri.protocol,this._linkUrl="sd:"+e,this._port<0&&(this._port=8602),this._connectTimeout=1e4,this._heartbeatInterval=2e4,this._autoReconnect=!0}getSchema(){return this._schema}getUrl(){return this._url}getUri(){return this._uri}getLinkUrl(){return this._linkUrl}getHost(){return this._uri.host}getPort(){return this._port}getHeartbeatInterval(){return this._heartbeatInterval}heartbeatInterval(e){return this._heartbeatInterval=e,this}getConnectTimeout(){return this._connectTimeout}connectTimeout(e){return this._connectTimeout=e,this}isAutoReconnect(){return this._autoReconnect}autoReconnect(e){return this._autoReconnect=e,this}idleTimeout(e){return 0==this._autoReconnect?(this._idleTimeout=e,this):(this._idleTimeout=0,this)}toString(){return"ClientConfig{schema='"+this._schema+"', charset="+this._charset+", url='"+this._url+"', heartbeatInterval="+this._heartbeatInterval+", connectTimeout="+this._connectTimeout+", idleTimeout="+this._idleTimeout+", requestTimeout="+this._requestTimeout+", readBufferSize="+this._readBufferSize+", writeBufferSize="+this._writeBufferSize+", autoReconnect="+this._autoReconnect+", maxUdpSize="+this._maxUdpSize+"}"}}t.ClientConfig=r},511:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClientConnectorBase=void 0,t.ClientConnectorBase=class{constructor(e){this._client=e}heartbeatHandler(){return this._client.getHeartbeatHandler()}heartbeatInterval(){return this._client.getHeartbeatInterval()}autoReconnect(){return this._client.getConfig().isAutoReconnect()}}},777:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClientHandshakeResult=void 0,t.ClientHandshakeResult=class{constructor(e,t){this._channel=e,this._throwable=t}getChannel(){return this._channel}getThrowable(){return this._throwable}}},911:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Asserts=void 0;const n=s(797),r=s(921);t.Asserts=class{static assertClosed(e){if(null!=e&&e.isClosed()>0)throw new r.SocketdChannelException("This channel is closed, sessionId="+e.getSession().sessionId())}static assertClosedByUser(e){if(null!=e&&e.isClosed()==n.Constants.CLOSE4_USER)throw new r.SocketdChannelException("This channel is closed, sessionId="+e.getSession().sessionId())}static assertNull(e,t){if(null==t)throw new Error("The argument cannot be null: "+e)}static assertEmpty(e,t){if(!t)throw new Error("The argument cannot be empty: "+e)}static assertSize(e,t,s){if(t>s){const n=`This message ${e} size is out of limit ${s} (${t})`;throw new r.SocketdSizeLimitException(n)}}}},560:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BlobBuffer=t.ByteBuffer=void 0,t.ByteBuffer=class{constructor(e){this._bufIdx=0,this._buf=e}remaining(){return this.size()-this.position()}position(){return this._bufIdx}size(){return this._buf.byteLength}reset(){this._bufIdx=0}getBytes(e,t){let s=this.remaining();if(s>e&&(s=e),s<=0)return!1;let n=this._bufIdx+s,r=this._buf.slice(this._bufIdx,n);return this._bufIdx=n,t(r),!0}getBlob(){return null}getArray(){return this._buf}},t.BlobBuffer=class{constructor(e){this._bufIdx=0,this._buf=e}remaining(){return this._buf.size-this._bufIdx}position(){return this._bufIdx}size(){return this._buf.size}reset(){this._bufIdx=0}getBytes(e,t){let s=this.remaining();if(s>e&&(s=e),s<=0)return!1;let n=this._bufIdx+s,r=this._buf.slice(this._bufIdx,n),i=new FileReader;return i.onload=e=>{e.target&&t(e.target.result)},i.readAsArrayBuffer(r),this._bufIdx=n,!0}getBlob(){return this._buf}getArray(){return null}}},998:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelBase=void 0;const n=s(954);t.ChannelBase=class{constructor(e){this._isClosed=0,this._config=e,this._attachments=new Map}getAttachment(e){return this._attachments.get(e)}putAttachment(e,t){null==t?this._attachments.delete(e):this._attachments.set(e,t)}isClosed(){return this._isClosed}close(e){this._isClosed=e,this._attachments.clear()}getConfig(){return this._config}setHandshake(e){this._handshake=e}getHandshake(){return this._handshake}sendConnect(e){this.send(n.Frames.connectFrame(this.getConfig().getIdGenerator().generate(),e),null)}sendConnack(e){this.send(n.Frames.connackFrame(e),null)}sendPing(){this.send(n.Frames.pingFrame(),null)}sendPong(){this.send(n.Frames.pongFrame(),null)}sendClose(){this.send(n.Frames.closeFrame(),null)}sendAlarm(e,t){this.send(n.Frames.alarmFrame(e,t),null)}}},930:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelDefault=void 0;const n=s(954),r=s(862),i=s(797),a=s(998),o=s(39);class l extends a.ChannelBase{constructor(e,t){super(t.getConfig()),this._source=e,this._processor=t.getProcessor(),this._assistant=t.getAssistant(),this._streamManger=t.getConfig().getStreamManger()}onOpenFuture(e){this._onOpenFuture=e}doOpenFuture(e,t){this._onOpenFuture&&this._onOpenFuture(e,t)}isValid(){return 0==this.isClosed()&&this._assistant.isValid(this._source)}config(){return this._config}sendPing(){this.send(n.Frames.pingFrame(),null)}sendPong(){this.send(n.Frames.pongFrame(),null)}send(e,t){if(e.message()){const s=e.message();if(null!=t&&this._streamManger.addStream(s.sid(),t),null!=s.entity())return s.dataSize()>this.getConfig().getFragmentSize()&&s.putMeta(i.EntityMetas.META_DATA_LENGTH,s.dataSize().toString()),void this.getConfig().getFragmentHandler().spliFragment(this,t,s,(t=>{const i=new n.Frame(e.flag(),(new r.MessageBuilder).flag(e.flag()).sid(s.sid()).event(s.event()).entity(t).build());this._assistant.write(this._source,i)}))}this._assistant.write(this._source,e),null!=t&&t.onProgress(!0,1,1)}retrieve(e,t){t?((t.demands()<i.Constants.DEMANDS_MULTIPLE||e.flag()==i.Flags.ReplyEnd)&&this._streamManger.removeStream(e.message().sid()),t.demands(),i.Constants.DEMANDS_MULTIPLE,t.onReply(e.message())):console.debug(`${this.getConfig().getRoleName()} stream not found, sid=${e.message().sid()}, sessionId=${this.getSession().sessionId()}`)}reconnect(){}onError(e){this._processor.onError(this,e)}getSession(){return null==this._session&&(this._session=new o.SessionDefault(this)),this._session}getStream(e){return this._streamManger.getStream(e)}setSession(e){this._session=e}close(e){console.debug(`${this.getConfig().getRoleName()} channel will be closed, sessionId=${this.getSession().sessionId()}`);try{super.close(e),this._assistant.close(this._source)}catch(e){console.warn(`${this.getConfig().getRoleName()} channel close error, sessionId=${this.getSession().sessionId()}`,e)}}}t.ChannelDefault=l},608:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayBufferCodecWriter=t.ArrayBufferCodecReader=void 0,t.ArrayBufferCodecReader=class{constructor(e){this._buf=e,this._bufView=new DataView(e),this._bufViewIdx=0}getByte(){if(this._bufViewIdx>=this._buf.byteLength)return-1;const e=this._bufView.getInt8(this._bufViewIdx);return this._bufViewIdx+=1,e}getBytes(e,t,s){const n=new DataView(e),r=t+s;for(let e=t;e<r&&!(this._bufViewIdx>=this._buf.byteLength);e++)n.setInt8(e,this._bufView.getInt8(this._bufViewIdx)),this._bufViewIdx++}getInt(){if(this._bufViewIdx>=this._buf.byteLength)return-1;const e=this._bufView.getInt32(this._bufViewIdx);return this._bufViewIdx+=4,e}remaining(){return this._buf.byteLength-this._bufViewIdx}position(){return this._bufViewIdx}size(){return this._buf.byteLength}reset(){this._bufViewIdx=0}},t.ArrayBufferCodecWriter=class{constructor(e){this._buf=new ArrayBuffer(e),this._bufView=new DataView(this._buf),this._bufViewIdx=0}putBytes(e){const t=new DataView(e),s=t.byteLength;for(let e=0;e<s;e++)this._bufView.setInt8(this._bufViewIdx,t.getInt8(e)),this._bufViewIdx+=1}putInt(e){this._bufView.setInt32(this._bufViewIdx,e),this._bufViewIdx+=4}putChar(e){this._bufView.setInt16(this._bufViewIdx,e),this._bufViewIdx+=2}flush(){}getBuffer(){return this._buf}}},905:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CodecByteBuffer=void 0;const n=s(954),r=s(404),i=s(911),a=s(797),o=s(862),l=s(165);t.CodecByteBuffer=class{constructor(e){this._config=e}write(e,t){if(e.message()){const s=r.StrUtils.strToBuf(e.message().sid(),this._config.getCharset()),n=r.StrUtils.strToBuf(e.message().event(),this._config.getCharset()),o=r.StrUtils.strToBuf(e.message().metaString(),this._config.getCharset()),l=8+s.byteLength+n.byteLength+o.byteLength+e.message().dataSize()+6;i.Asserts.assertSize("sid",s.byteLength,a.Constants.MAX_SIZE_SID),i.Asserts.assertSize("event",n.byteLength,a.Constants.MAX_SIZE_EVENT),i.Asserts.assertSize("metaString",o.byteLength,a.Constants.MAX_SIZE_META_STRING),i.Asserts.assertSize("data",e.message().dataSize(),a.Constants.MAX_SIZE_DATA);const h=t(l);return h.putInt(l),h.putInt(e.flag()),h.putBytes(s),h.putChar("\n".charCodeAt(0)),h.putBytes(n),h.putChar("\n".charCodeAt(0)),h.putBytes(o),h.putChar("\n".charCodeAt(0)),h.putBytes(e.message().data().getArray()),h.flush(),h}{const s=8,n=t(s);return n.putInt(s),n.putInt(e.flag()),n.flush(),n}}read(e){const t=e.getInt();if(t>e.remaining()+4)return null;const s=e.getInt();if(8==t)return new n.Frame(a.Flags.of(s),null);{const r=Math.min(a.Constants.MAX_SIZE_META_STRING,e.remaining()),i=new ArrayBuffer(r),h=this.decodeString(e,i,a.Constants.MAX_SIZE_SID),u=this.decodeString(e,i,a.Constants.MAX_SIZE_EVENT),c=this.decodeString(e,i,a.Constants.MAX_SIZE_META_STRING),d=t-e.position();let _;if(d>a.Constants.MAX_SIZE_DATA){_=new ArrayBuffer(a.Constants.MAX_SIZE_DATA),e.getBytes(_,0,a.Constants.MAX_SIZE_DATA);for(let t=d-a.Constants.MAX_SIZE_DATA;t>0;t--)e.getByte()}else _=new ArrayBuffer(d),d>0&&e.getBytes(_,0,d);const g=(new o.MessageBuilder).flag(a.Flags.of(s)).sid(h).event(u).entity((new l.EntityDefault).dataSet(_).metaStringSet(c)).build();return new n.Frame(g.flag(),g)}}decodeString(e,t,s){const n=new DataView(t);let i=0;for(;;){const t=e.getByte();if(10==t)break;s>0&&s<=i||0!=t&&(n.setInt8(i,t),i++)}return i<1?"":r.StrUtils.bufToStr(t,0,i,this._config.getCharset())}}},628:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigBase=void 0;const n=s(895),r=s(67),i=s(351),a=s(797),o=s(911),l=s(905);t.ConfigBase=class{constructor(e){this._clientMode=e,this._streamManger=new n.StreamMangerDefault(this),this._codec=new l.CodecByteBuffer(this),this._charset="utf-8",this._idGenerator=new r.GuidGenerator,this._fragmentHandler=new i.FragmentHandlerDefault,this._fragmentSize=a.Constants.MAX_SIZE_DATA,this._coreThreads=2,this._maxThreads=4*this._coreThreads,this._readBufferSize=512,this._writeBufferSize=512,this._idleTimeout=0,this._requestTimeout=1e4,this._streamTimeout=72e5,this._maxUdpSize=2048}clientMode(){return this._clientMode}getStreamManger(){return this._streamManger}getRoleName(){return this.clientMode()?"Client":"Server"}getCharset(){return this._charset}charset(e){return this._charset=e,this}getCodec(){return this._codec}getIdGenerator(){return this._idGenerator}idGenerator(e){return o.Asserts.assertNull("idGenerator",e),this._idGenerator=e,this}getFragmentHandler(){return this._fragmentHandler}fragmentHandler(e){return o.Asserts.assertNull("fragmentHandler",e),this._fragmentHandler=e,this}getFragmentSize(){return this._fragmentSize}fragmentSize(e){if(e>a.Constants.MAX_SIZE_DATA)throw new Error("The parameter fragmentSize cannot > 16m");if(e<a.Constants.MIN_FRAGMENT_SIZE)throw new Error("The parameter fragmentSize cannot < 1k");return this._fragmentSize=e,this}getCoreThreads(){return this._coreThreads}coreThreads(e){return this._coreThreads=e,this._maxThreads=4*e,this}getMaxThreads(){return this._maxThreads}maxThreads(e){return this._maxThreads=e,this}getReadBufferSize(){return this._readBufferSize}readBufferSize(e){return this._readBufferSize=e,this}getWriteBufferSize(){return this._writeBufferSize}writeBufferSize(e){return this._writeBufferSize=e,this}getIdleTimeout(){return this._idleTimeout}idleTimeout(e){return this._idleTimeout=e,this}getRequestTimeout(){return this._requestTimeout}requestTimeout(e){return this._requestTimeout=e,this}getStreamTimeout(){return this._streamTimeout}streamTimeout(e){return this._streamTimeout=e,this}getMaxUdpSize(){return this._maxUdpSize}maxUdpSize(e){return this._maxUdpSize=e,this}generateId(){return this._idGenerator.generate()}}},797:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityMetas=t.Flags=t.Constants=void 0;const n=s(560);t.Constants={DEF_SID:"",DEF_EVENT:"",DEF_META_STRING:"",DEF_DATA:new n.ByteBuffer(new ArrayBuffer(0)),CLOSE1_PROTOCOL:1,CLOSE2_PROTOCOL_ILLEGAL:2,CLOSE3_ERROR:3,CLOSE4_USER:4,MAX_SIZE_SID:64,MAX_SIZE_EVENT:512,MAX_SIZE_META_STRING:4096,MAX_SIZE_DATA:16777216,MIN_FRAGMENT_SIZE:1024,DEMANDS_ZERO:0,DEMANDS_SIGNLE:1,DEMANDS_MULTIPLE:2},t.Flags={Unknown:0,Connect:10,Connack:11,Ping:20,Pong:21,Close:30,Alarm:31,Message:40,Request:41,Subscribe:42,Reply:48,ReplyEnd:49,of:function(e){switch(e){case 10:return this.Connect;case 11:return this.Connack;case 20:return this.Ping;case 21:return this.Pong;case 30:return this.Close;case 31:return this.Alarm;case 40:return this.Message;case 41:return this.Request;case 42:return this.Subscribe;case 48:return this.Reply;case 49:return this.ReplyEnd;default:return this.Unknown}},name:function(e){switch(e){case this.Connect:return"Connect";case this.Connack:return"Connack";case this.Ping:return"Ping";case this.Pong:return"Pong";case this.Close:return"Close";case this.Alarm:return"Alarm";case this.Message:return"Message";case this.Request:return"Request";case this.Subscribe:return"Subscribe";case this.Reply:return"Reply";case this.ReplyEnd:return"ReplyEnd";default:return"Unknown"}}},t.EntityMetas={META_SOCKETD_VERSION:"Socket.D",META_DATA_LENGTH:"Data-Length",META_DATA_TYPE:"Data-Type",META_DATA_FRAGMENT_IDX:"Data-Fragment-Idx",META_DATA_FRAGMENT_TOTAL:"Data-Fragment-Total",META_DATA_DISPOSITION_FILENAME:"Data-Disposition-Filename",META_RANGE_START:"Data-Range-Start",META_RANGE_SIZE:"Data-Range-Size"}},165:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileEntity=t.StringEntity=t.EntityDefault=void 0;const n=s(404),r=s(608),i=s(797),a=s(560),o=s(921);class l{constructor(){this._metaMap=null,this._data=i.Constants.DEF_DATA,this._dataAsReader=null}at(){return this.meta("@")}metaStringSet(e){return this._metaMap=new URLSearchParams(e),this}metaMapPut(e){if(e instanceof URLSearchParams)e.forEach(((e,t,s)=>{this.metaMap().set(t,e)}));else for(const t of e.prototype)this.metaMap().set(t,e[t]);return this}metaPut(e,t){return this.metaMap().set(e,t),this}metaString(){return this.metaMap().toString()}metaMap(){return null==this._metaMap&&(this._metaMap=new URLSearchParams),this._metaMap}meta(e){return this.metaMap().get(e)}metaOrDefault(e,t){return this.meta(e)||t}metaAsInt(e){return parseInt(this.metaOrDefault(e,"0"))}metaAsFloat(e){return parseFloat(this.metaOrDefault(e,"0"))}putMeta(e,t){this.metaPut(e,t)}dataSet(e){return e instanceof Blob?this._data=new a.BlobBuffer(e):this._data=new a.ByteBuffer(e),this}data(){return this._data}dataAsReader(){if(null==this._data.getArray())throw new o.SocketdException("Blob does not support dataAsReader");return this._dataAsReader||(this._dataAsReader=new r.ArrayBufferCodecReader(this._data.getArray())),this._dataAsReader}dataAsString(){if(null==this._data.getArray())throw new o.SocketdException("Blob does not support dataAsString");return n.StrUtils.bufToStrDo(this._data.getArray(),"")}dataSize(){return this._data.size()}release(){}toString(){return"Entity{meta='"+this.metaString()+"', data=byte["+this.dataSize()+"]}"}}t.EntityDefault=l,t.StringEntity=class extends l{constructor(e){super();const t=n.StrUtils.strToBuf(e);this.dataSet(t)}},t.FileEntity=class extends l{constructor(e){super(),this.dataSet(e),this.metaPut(i.EntityMetas.META_DATA_DISPOSITION_FILENAME,e.name)}}},187:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FragmentAggregatorDefault=void 0;const n=s(862),r=s(165),i=s(954),a=s(72),o=s(797),l=s(921);t.FragmentAggregatorDefault=class{constructor(e){this._fragmentHolders=new Array,this._dataStreamSize=0,this._dataLength=0,this._main=e;const t=e.meta(o.EntityMetas.META_DATA_LENGTH);if(!t)throw new l.SocketdCodecException("Missing '"+o.EntityMetas.META_DATA_LENGTH+"' meta, event="+e.event());this._dataLength=parseInt(t)}getSid(){return this._main.sid()}getDataStreamSize(){return this._dataStreamSize}getDataLength(){return this._dataLength}add(e,t){this._fragmentHolders.push(new a.FragmentHolder(e,t)),this._dataStreamSize=this._dataStreamSize+t.dataSize()}get(){this._fragmentHolders.sort(((e,t)=>e.getIndex()==t.getIndex()?0:e.getIndex()>t.getIndex()?1:-1));const e=new ArrayBuffer(this._dataLength),t=new DataView(e);let s=0;for(const e of this._fragmentHolders){const n=new DataView(e.getMessage().data().getArray());for(let r=0;r<e.getMessage().data().size();r++)t.setInt8(s,n.getInt8(r)),s++}return new i.Frame(this._main.flag(),(new n.MessageBuilder).flag(this._main.flag()).sid(this._main.sid()).event(this._main.event()).entity((new r.EntityDefault).metaMapPut(this._main.metaMap()).dataSet(e)).build())}}},351:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FragmentHandlerDefault=void 0;const n=s(165),r=s(797),i=s(187);t.FragmentHandlerDefault=class{spliFragment(e,t,s,r){if(s.dataSize()>e.getConfig().getFragmentSize()){let n=0,i=s.dataSize()/e.getConfig().getFragmentSize();s.dataSize()%e.getConfig().getFragmentSize()>0&&i++,this.spliFragmentDo(n,i,e,t,s,r)}else null==s.data().getBlob()?(r(s),null!=t&&t.onProgress(!0,1,1)):s.data().getBytes(e.getConfig().getFragmentSize(),(e=>{r((new n.EntityDefault).dataSet(e).metaMapPut(s.metaMap())),null!=t&&t.onProgress(!0,1,1)}))}spliFragmentDo(e,t,s,i,a,o){e++,a.data().getBytes(s.getConfig().getFragmentSize(),(l=>{const h=(new n.EntityDefault).dataSet(l);1==e&&h.metaMapPut(a.metaMap()),h.metaPut(r.EntityMetas.META_DATA_FRAGMENT_IDX,e.toString()),h.metaPut(r.EntityMetas.META_DATA_FRAGMENT_TOTAL,t.toString()),o(h),null!=i&&i.onProgress(!0,e,e),this.spliFragmentDo(e,t,s,i,a,o)}))}aggrFragment(e,t,s){let n=e.getAttachment(s.sid());return n||(n=new i.FragmentAggregatorDefault(s),e.putAttachment(n.getSid(),n)),n.add(t,s),n.getDataLength()>n.getDataStreamSize()?null:(e.putAttachment(s.sid(),null),n.get())}aggrEnable(){return!0}}},72:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FragmentHolder=void 0,t.FragmentHolder=class{constructor(e,t){this._index=e,this._message=t}getIndex(){return this._index}getMessage(){return this._message}}},954:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Frames=t.Frame=void 0;const n=s(165),r=s(797),i=s(862),a=s(704);class o{constructor(e,t){this._flag=e,this._message=t}flag(){return this._flag}message(){return this._message}toString(){return"Frame{flag="+r.Flags.name(this._flag)+", message="+this._message+"}"}}t.Frame=o,t.Frames=class{static connectFrame(e,t){const s=new n.StringEntity(t);return s.metaPut(r.EntityMetas.META_SOCKETD_VERSION,a.SocketD.protocolVersion()),new o(r.Flags.Connect,(new i.MessageBuilder).sid(e).event(t).entity(s).build())}static connackFrame(e){const t=new n.EntityDefault;return t.metaPut(r.EntityMetas.META_SOCKETD_VERSION,a.SocketD.protocolVersion()),t.dataSet(e.data().getArray()),new o(r.Flags.Connack,(new i.MessageBuilder).sid(e.sid()).event(e.event()).entity(t).build())}static pingFrame(){return new o(r.Flags.Ping,null)}static pongFrame(){return new o(r.Flags.Pong,null)}static closeFrame(){return new o(r.Flags.Close,null)}static alarmFrame(e,t){const s=new i.MessageBuilder;return null!=e?(s.sid(e.sid()),s.event(e.event()),s.entity(new n.StringEntity(t).metaStringSet(e.metaString()))):s.entity(new n.StringEntity(t)),new o(r.Flags.Alarm,s.build())}}},953:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HandshakeDefault=void 0;const n=s(797);t.HandshakeDefault=class{constructor(e){let t=e.dataAsString();null!=t&&""!=t||(t=e.event()),this._source=e,this._url=new URL(t),this._version=e.meta(n.EntityMetas.META_SOCKETD_VERSION),this._paramMap=new Map;for(const[e,t]of this._url.searchParams)this._paramMap.set(e,t)}getSource(){return this._source}param(e){return this._paramMap.get(e)}paramMap(){return this._paramMap}paramOrDefault(e,t){return this.param(e)||t}paramPut(e,t){this._paramMap.set(e,t)}uri(){return this._url}version(){return this._version}}},569:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HeartbeatHandlerDefault=void 0,t.HeartbeatHandlerDefault=class{constructor(e){this._heartbeatHandler=e}heartbeat(e){null==this._heartbeatHandler?e.sendPing():this._heartbeatHandler(e)}}},67:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GuidGenerator=void 0;const n=s(404);t.GuidGenerator=class{generate(){return n.StrUtils.guid()}}},852:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PipelineListener=t.PathListener=t.EventListener=t.SimpleListener=void 0;const n=s(789);t.SimpleListener=class{onOpen(e){}onMessage(e,t){}onClose(e){}onError(e,t){}},t.EventListener=class{constructor(e){this._eventRouteSelector=e||new n.RouteSelectorDefault}doOn(e,t){return this._eventRouteSelector.put(e,t),this}doOnOpen(e){return this._doOnOpen=e,this}doOnMessage(e){return this._doOnMessage=e,this}doOnClose(e){return this._doOnClose=e,this}doOnError(e){return this._doOnError=e,this}onOpen(e){this._doOnOpen&&this._doOnOpen(e)}onMessage(e,t){this._doOnMessage&&this._doOnMessage(e,t);const s=this._eventRouteSelector.select(t.event());s&&s(e,t)}onClose(e){this._doOnClose&&this._doOnClose(e)}onError(e,t){this._doOnError&&this._doOnError(e,t)}},t.PathListener=class{constructor(e){this._pathRouteSelector=e||new n.RouteSelectorDefault}of(e,t){return this._pathRouteSelector.put(e,t),this}size(){return this._pathRouteSelector.size()}onOpen(e){const t=this._pathRouteSelector.select(e.path());null!=t&&t.onOpen(e)}onMessage(e,t){const s=this._pathRouteSelector.select(e.path());null!=s&&s.onMessage(e,t)}onClose(e){const t=this._pathRouteSelector.select(e.path());null!=t&&t.onClose(e)}onError(e,t){const s=this._pathRouteSelector.select(e.path());null!=s&&s.onError(e,t)}},t.PipelineListener=class{constructor(){this._deque=new Array}prev(e){return this._deque.unshift(e),this}next(e){return this._deque.push(e),this}size(){return this._deque.length}onOpen(e){for(const t of this._deque)t.onOpen(e)}onMessage(e,t){for(const s of this._deque)s.onMessage(e,t)}onClose(e){for(const t of this._deque)t.onClose(e)}onError(e,t){for(const s of this._deque)s.onError(e,t)}}},862:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDefault=t.MessageBuilder=void 0;const n=s(797);t.MessageBuilder=class{constructor(){this._flag=n.Flags.Unknown,this._sid=n.Constants.DEF_SID,this._event=n.Constants.DEF_EVENT,this._entity=null}flag(e){return this._flag=e,this}sid(e){return this._sid=e,this}event(e){return this._event=e,this}entity(e){return this._entity=e,this}build(){return new r(this._flag,this._sid,this._event,this._entity)}};class r{constructor(e,t,s,n){this._flag=e,this._sid=t,this._event=s,this._entity=n}at(){return this._entity.at()}flag(){return this._flag}isRequest(){return this._flag==n.Flags.Request}isSubscribe(){return this._flag==n.Flags.Subscribe}isEnd(){return this._flag==n.Flags.ReplyEnd}sid(){return this._sid}event(){return this._event}entity(){return this._entity}toString(){return"Message{sid='"+this._sid+"', event='"+this._event+"', entity="+this._entity+"}"}metaString(){return this._entity.metaString()}metaMap(){return this._entity.metaMap()}meta(e){return this._entity.meta(e)}metaOrDefault(e,t){return this._entity.metaOrDefault(e,t)}metaAsInt(e){return this._entity.metaAsInt(e)}metaAsFloat(e){return this._entity.metaAsFloat(e)}putMeta(e,t){this._entity.putMeta(e,t)}data(){return this._entity.data()}dataAsReader(){return this._entity.dataAsReader()}dataAsString(){return this._entity.dataAsString()}dataSize(){return this._entity.dataSize()}release(){this._entity&&this._entity.release()}}t.MessageDefault=r},405:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProcessorDefault=void 0;const n=s(852),r=s(797),i=s(921),a=s(953);t.ProcessorDefault=class{constructor(){this._listener=new n.SimpleListener}setListener(e){null!=e&&(this._listener=e)}onReceive(e,t){if(t.flag()==r.Flags.Connect)e.setHandshake(new a.HandshakeDefault(t.message())),e.onOpenFuture(((s,n)=>{if(s&&e.isValid())try{e.sendConnack(t.message())}catch(n){this.onError(e,n)}})),this.onOpen(e);else if(t.flag()==r.Flags.Connack)e.setHandshake(new a.HandshakeDefault(t.message())),this.onOpen(e);else{if(null==e.getHandshake()){if(e.close(r.Constants.CLOSE1_PROTOCOL),t.flag()==r.Flags.Close)throw new i.SocketdConnectionException("Connection request was rejected");return void console.warn(`${e.getConfig().getRoleName()} channel handshake is null, sessionId=${e.getSession().sessionId()}`)}try{switch(t.flag()){case r.Flags.Ping:e.sendPong();break;case r.Flags.Pong:break;case r.Flags.Close:e.close(r.Constants.CLOSE1_PROTOCOL),this.onCloseInternal(e);break;case r.Flags.Alarm:{const s=new i.SocketdAlarmException(t.message()),n=e.getConfig().getStreamManger().getStream(t.message().sid());null==n?this.onError(e,s):(e.getConfig().getStreamManger().removeStream(t.message().sid()),n.onError(s));break}case r.Flags.Message:case r.Flags.Request:case r.Flags.Subscribe:this.onReceiveDo(e,t,!1);break;case r.Flags.Reply:case r.Flags.ReplyEnd:this.onReceiveDo(e,t,!0);break;default:e.close(r.Constants.CLOSE2_PROTOCOL_ILLEGAL),this.onCloseInternal(e)}}catch(t){this.onError(e,t)}}}onReceiveDo(e,t,s){let n=null,i=1,a=1;if(s&&(n=e.getStream(t.message().sid())),e.getConfig().getFragmentHandler().aggrEnable()){const s=t.message().meta(r.EntityMetas.META_DATA_FRAGMENT_IDX);if(s){i=parseInt(s);const o=e.getConfig().getFragmentHandler().aggrFragment(e,i,t.message());if(n&&(a=parseInt(t.message().metaOrDefault(r.EntityMetas.META_DATA_FRAGMENT_TOTAL,"1"))),null==o)return void(n&&n.onProgress(!1,i,a));t=o}}s?(n&&n.onProgress(!1,i,a),e.retrieve(t,n)):this.onMessage(e,t.message())}onOpen(e){try{this._listener.onOpen(e.getSession()),e.doOpenFuture(!0,null)}catch(t){console.warn(`${e.getConfig().getRoleName()} channel listener onOpen error`,t),e.doOpenFuture(!1,t)}}onMessage(e,t){try{this._listener.onMessage(e.getSession(),t)}catch(t){console.warn(`${e.getConfig().getRoleName()} channel listener onMessage error`,t),this.onError(e,t)}}onClose(e){0==e.isClosed()&&this.onCloseInternal(e)}onCloseInternal(e){this._listener.onClose(e.getSession())}onError(e,t){this._listener.onError(e.getSession(),t)}}},789:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RouteSelectorDefault=void 0,t.RouteSelectorDefault=class{constructor(){this._inner=new Map}select(e){return this._inner.get(e)}put(e,t){this._inner.set(e,t)}remove(e){this._inner.delete(e)}size(){return this._inner.size}}},305:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionBase=void 0,t.SessionBase=class{constructor(e){this._channel=e,this._sessionId=this.generateId()}sessionId(){return this._sessionId}name(){return this.param("@")}attrMap(){return null==this._attrMap&&(this._attrMap=new Map),this._attrMap}attrHas(e){return null!=this._attrMap&&this._attrMap.has(e)}attr(e){return null==this._attrMap?null:this._attrMap.get(e)}attrOrDefault(e,t){return this.attr(e)||t}attrPut(e,t){this.attrMap().set(e,t)}generateId(){return this._channel.getConfig().getIdGenerator().generate()}}},39:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionDefault=void 0;const n=s(305),r=s(862),i=s(954),a=s(797),o=s(895);class l extends n.SessionBase{constructor(e){super(e)}isValid(){return this._channel.isValid()}handshake(){return this._channel.getHandshake()}param(e){return this.handshake().param(e)}paramOrDefault(e,t){return this.handshake().paramOrDefault(e,t)}path(){return null==this._pathNew?this.handshake().uri().pathname:this._pathNew}pathNew(e){this._pathNew=e}reconnect(){this._channel.reconnect()}sendPing(){this._channel.sendPing()}sendAlarm(e,t){this._channel.sendAlarm(e,t)}send(e,t,s){const n=(new r.MessageBuilder).sid(this.generateId()).event(e).entity(t).build(),l=new o.SendStreamImpl(n.sid());return s&&s(l),this._channel.send(new i.Frame(a.Flags.Message,n),l),l}sendAndRequest(e,t,s,n){const l=(new r.MessageBuilder).sid(this.generateId()).event(e).entity(t).build();s||(s=0),s<10&&(s=this._channel.getConfig().getRequestTimeout());const h=new o.RequestStreamImpl(l.sid(),s);return n&&n(h),this._channel.send(new i.Frame(a.Flags.Request,l),h),h}sendAndSubscribe(e,t,s,n){const l=(new r.MessageBuilder).sid(this.generateId()).event(e).entity(t).build();s||(s=0),s<10&&(s=this._channel.getConfig().getStreamTimeout());const h=new o.SubscribeStreamImpl(l.sid(),s);return n&&n(h),this._channel.send(new i.Frame(a.Flags.Subscribe,l),h),h}reply(e,t){const s=(new r.MessageBuilder).sid(e.sid()).event(e.event()).entity(t).build();this._channel.send(new i.Frame(a.Flags.Reply,s),null)}replyEnd(e,t){const s=(new r.MessageBuilder).sid(e.sid()).event(e.event()).entity(t).build();this._channel.send(new i.Frame(a.Flags.ReplyEnd,s),null)}close(){if(console.debug(`${this._channel.getConfig().getRoleName()} session will be closed, sessionId=${this.sessionId()}`),this._channel.isValid())try{this._channel.sendClose()}catch(e){console.warn(`${this._channel.getConfig().getRoleName()} channel sendClose error`,e)}this._channel.close(a.Constants.CLOSE4_USER)}}t.SessionDefault=l},895:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamMangerDefault=t.SubscribeStreamImpl=t.RequestStreamImpl=t.SendStreamImpl=t.StreamBase=void 0;const n=s(921),r=s(911),i=s(797);class a{constructor(e,t,s){this._sid=e,this._demands=t,this._timeout=s}sid(){return this._sid}demands(){return this._demands}timeout(){return this._timeout}insuranceStart(e,t){this._insuranceFuture||(this._insuranceFuture=setTimeout((()=>{e.removeStream(this.sid()),this.onError(new n.SocketdTimeoutException("The stream response timeout, sid="+this.sid()))}),t))}insuranceCancel(){this._insuranceFuture&&clearTimeout(this._insuranceFuture)}onError(e){this._doOnError&&this._doOnError(e)}onProgress(e,t,s){this._doOnProgress&&this._doOnProgress(e,t,s)}thenError(e){return this._doOnError=e,this}thenProgress(e){return this._doOnProgress=e,this}}t.StreamBase=a,t.SendStreamImpl=class extends a{constructor(e){super(e,i.Constants.DEMANDS_ZERO,0)}isDone(){return!0}onReply(e){}},t.RequestStreamImpl=class extends a{constructor(e,t){super(e,i.Constants.DEMANDS_SIGNLE,t),this._isDone=!1}isDone(){return this._isDone}onReply(e){this._isDone=!0;try{this._doOnReply&&this._doOnReply(e)}catch(e){this.onError(e)}}await(){return new Promise(((e,t)=>{this.thenReply((t=>{e(t)})).thenError((e=>{t(e)}))}))}thenReply(e){return this._doOnReply=e,this}},t.SubscribeStreamImpl=class extends a{constructor(e,t){super(e,i.Constants.DEMANDS_MULTIPLE,t),this._isDone=!1}isDone(){return this._isDone}onReply(e){this._isDone=e.isEnd();try{this._doOnReply&&this._doOnReply(e)}catch(e){this.onError(e)}}thenReply(e){return this._doOnReply=e,this}},t.StreamMangerDefault=class{constructor(e){this._config=e,this._streamMap=new Map}getStream(e){return this._streamMap.get(e)||null}addStream(e,t){if(r.Asserts.assertNull("stream",t),t.demands()==i.Constants.DEMANDS_ZERO)return;this._streamMap.set(e,t);const s=t.timeout()>0?t.timeout():this._config.getStreamTimeout();s>0&&t.insuranceStart(this,s)}removeStream(e){const t=this.getStream(e);t&&(this._streamMap.delete(e),t.insuranceCancel(),console.debug(`${this._config.getRoleName()} stream removed, sid=${e}`))}}},174:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WsChannelAssistant=void 0;const n=s(608);t.WsChannelAssistant=class{constructor(e){this._config=e}read(e){return this._config.getCodec().read(new n.ArrayBufferCodecReader(e))}write(e,t){let s=this._config.getCodec().write(t,(e=>new n.ArrayBufferCodecWriter(e)));e.send(s.getBuffer())}isValid(e){return e.readyState===WebSocket.OPEN}close(e){e.close()}getRemoteAddress(e){throw new Error("Method not implemented.")}getLocalAddress(e){throw new Error("Method not implemented.")}}},976:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WsClient=void 0;const n=s(421),r=s(174),i=s(882);class a extends n.ClientBase{constructor(e){super(e,new r.WsChannelAssistant(e))}createConnector(){return new i.WsClientConnector(this)}}t.WsClient=a},882:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WsClientConnector=void 0;const n=s(511),r=s(356);class i extends n.ClientConnectorBase{constructor(e){super(e)}connect(){this.close();let e=this._client.getConfig().getUrl();return new Promise(((t,s)=>{this._real=new r.WebSocketClientImpl(e,this._client,(e=>{e.getThrowable()?s(e.getThrowable()):t(e.getChannel())}))}))}close(){this._real&&this._real.close()}}t.WsClientConnector=i},481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WsClientProvider=void 0;const n=s(976);t.WsClientProvider=class{schemas(){return["ws","wss","sd:ws","sd:wss"]}createClient(e){return new n.WsClient(e)}}},356:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketClientImpl=void 0;const n=s(777),r=s(930),i=s(797),a=s(921);t.WebSocketClientImpl=class{constructor(e,t,s){this._real=new WebSocket(e),this._client=t,this._channel=new r.ChannelDefault(this._real,t),this._handshakeFuture=s,this._real.binaryType="arraybuffer",this._real.onopen=this.onOpen.bind(this),this._real.onmessage=this.onMessage.bind(this),this._real.onclose=this.onClose.bind(this),this._real.onerror=this.onError.bind(this)}onOpen(e){try{this._channel.sendConnect(this._client.getConfig().getUrl())}catch(e){console.warn("Client channel sendConnect error",e)}}onMessage(e){if(e.data instanceof String)console.warn("Client channel unsupported onMessage(String test)");else try{let t=this._client.getAssistant().read(e.data);null!=t&&(t.flag()==i.Flags.Connack&&this._channel.onOpenFuture(((e,t)=>{null==t?this._handshakeFuture(new n.ClientHandshakeResult(this._channel,null)):this._handshakeFuture(new n.ClientHandshakeResult(this._channel,t))})),this._client.getProcessor().onReceive(this._channel,t))}catch(e){e instanceof a.SocketdConnectionException&&this._handshakeFuture(new n.ClientHandshakeResult(this._channel,e)),console.warn("WebSocket client onMessage error",e)}}onClose(e){this._client.getProcessor().onClose(this._channel)}onError(e){this._client.getProcessor().onError(this._channel,e)}close(){this._real.close()}}},422:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RunUtils=void 0,t.RunUtils=class{static runAndTry(e){try{e()}catch(e){}}}},404:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StrUtils=void 0;class s{static guid(){let e="";for(let t=1;t<=32;t++)e+=Math.floor(16*Math.random()).toString(16);return e}static strToBuf(e,t){return t||(t="utf-8"),(new TextEncoder).encode(e).buffer}static bufToStr(e,t,n,r){if(e.byteLength!=n){const s=new DataView(e),r=new ArrayBuffer(n),i=new DataView(r);for(let e=0;e<n;e++)i.setInt8(e,s.getInt8(t+e));e=r}return s.bufToStrDo(e,r)}static bufToStrDo(e,t){return t||(t="utf-8"),new TextDecoder(t).decode(e)}}t.StrUtils=s}},t={},s=function s(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}(704),n=window;for(var r in s)n[r]=s[r];s.__esModule&&Object.defineProperty(n,"__esModule",{value:!0});